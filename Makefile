
TARGET = shotwell

VALAC = valac
INSTALL_PROGRAM = install
INSTALL_DATA = install -m 644

VALAFLAGS = -g --enable-checking
ifdef dev
DEVFLAGS = --save-temps
endif

# C99 takes care of a warning message generated by the use of Math.round in image_util.vala
ALL_VALAFLAGS = $(VALAFLAGS) $(DEVFLAGS) --Xcc=-std=c99

PREFIX=/usr/local
DESKTOP_DIR=/usr/share/applications
-include configure.in

SRC_FILES = \
	main.vala \
	AppWindow.vala \
	CollectionPage.vala \
	Thumbnail.vala \
	DatabaseTables.vala \
	ThumbnailCache.vala \
	image_util.vala \
	CollectionLayout.vala \
	PhotoPage.vala \
	Exif.vala \
	Page.vala \
	ImportPage.vala \
	GPhoto.vala \
	SortedList.vala \
	EventsDirectoryPage.vala \
	Dimensions.vala \
	Box.vala \
	Photo.vala \
	Orientation.vala \
	util.vala \
	BatchImport.vala \
	ExportDialog.vala \
	Resources.vala

VAPI_FILES = \
	libexif.vapi \
	fstream.vapi \
	libgphoto2.vapi

RESOURCE_FILES = \
	photo.ui \
	collection.ui \
	import.ui \
	fullscreen.ui

HEADER_FILES = \
	gphoto.h

VAPI_DIRS = \
	.

HEADER_DIRS = \
	.

LOCAL_PKGS = \
	libexif \
	fstream \
	libgphoto2 \

EXT_PKGS = \
	gtk+-2.0 \
	sqlite3 \
	vala-1.0 \
	hal \
	dbus-glib-1 \
	unique-1.0

PKGS = $(EXT_PKGS) $(LOCAL_PKGS)

all: $(TARGET)

clean:
	rm -f *.c
	rm -f $(CONFIG_IN)
	rm -f $(TARGET)

cleantemps:
	rm -f *.c

install: $(TARGET) shotwell.desktop
	$(INSTALL_PROGRAM) $(TARGET) $(DESTDIR)$(PREFIX)/bin
	mkdir -p $(DESTDIR)$(PREFIX)/share/shotwell/icons
	$(INSTALL_DATA) icons/* $(DESTDIR)$(PREFIX)/share/shotwell/icons
	mkdir -p $(DESTDIR)$(PREFIX)/share/shotwell/ui
	$(INSTALL_DATA) ui/* $(DESTDIR)$(PREFIX)/share/shotwell/ui
	$(INSTALL_DATA) shotwell.desktop $(DESTDIR)$(DESKTOP_DIR)

uninstall:
	rm -f $(DESTDIR)$(PREFIX)/bin/$(TARGET)
	rm -fr $(DESTDIR)$(PREFIX)/share/shotwell
	rm -f $(DESTDIR)$(DESKTOP_DIR)/shotwell.desktop

$(TARGET): $(SRC_FILES) $(VAPI_FILES) $(HEADER_FILES) Makefile configure $(CONFIG_IN)
	pkg-config --print-errors --exists $(EXT_PKGS)
	$(VALAC) $(ALL_VALAFLAGS) \
	$(foreach pkg,$(PKGS),--pkg=$(pkg)) \
	$(foreach vapidir,$(VAPI_DIRS), --vapidir=$(vapidir)) \
	$(foreach hdir,$(HEADER_DIRS),-X -I$(hdir)) \
	-X -DPREFIX='"$(PREFIX)"' \
	$(SRC_FILES) \
	-o $(TARGET)

